<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <style>
    /*Color for global dataset*/
    .circle--positive {
      fill: #C48189;
    }
    .circle--negative {
      fill: #CFECEC;
    }
    .circle:hover {
      fill: #347C17;
    }
    
    .toolTip {
      position: absolute;
      display: none;
      min-width: 80px;
      height: auto;
      background: none repeat scroll 0 0 #ffffff;
      border: 1px solid #6F257F;
      padding: 14px;
      text-align: center;
    }
    h2 {
      font-size : 100%;
      color:#489450;
    }
    h3 {
      font-size : 140%;
      color:#696969;
      text-align: center;
    }
    .xaxis text {
      color:blue;
    }
    .yaxis text {
      color:blue;
    }
    #svgcontainer {
    display: inline-block;
    }
    #explcontainer {
        display: inline-block;
    }
    </style>
    
    <h3>Global warming is a reality, all over the globe !</h3>
    <div id="wrapper">

      <div id = "svgcontainer">
            <h2>Dataset</h2>
            <div>
              <p id = "subTitleP" style="color:#789410;font-size:85%">Promedian temperature change (reference: promedian of the years 1950-1980) for each group of 5 years</p>
              <button title="Explore over the planet" id = "swButton" style="padding: 3px 3px; text-align: center;font-size: 75%;margin: 2px 1px;">Switch dataset</button>
              <button title="Show region subdivisions data" disabled id = "zoomButton" style="padding: 3px 3px; text-align: center;font-size: 75%;margin: 2px 1px;">Show dataset details</button>
            </div>
      </div>

       <div id = "explcontainer">
            <img src="https://raw.githubusercontent.com/pierreraimbaud/GlobalWarmingIsReal/master/World_map_With_Parallels.jpg" style="width:30%;height:30%;" alt="World division N-S">
            <p>Here, for the visualization by zones and subzones (detailed visualization), we used this division with the parallels 90, 64, 44, 24 North and South and the Equator.</p>
            <p>This picture is a modified version of <a href="https://upload.wikimedia.org/wikipedia/commons/0/0a/World_map_2004_CIA_large_2m.jpg">an original picture</a> which is published in public domain (author : Central Intelligence Agency).</p>
            <br/><br/>
            <h2>What, why and how ? Understanding this visualization thanks to abstraction</h2>
              <p style="color:#111111;">
              This visualization uses data from data.giss.nasa.gov. The principal objective here is to show or discover some interesting insights about this data, knowing that the principal question asked was:<br/><b>Show that the global warming is a reality, all over the globe!</b>
              <br/><br/>
              The other objetives are more academic: to use d3, to publish the web page on GithubPages etc. The technologies used are d3 (javascript), HTML, CSS and git (nodejs for developing with a local server). There is no specific prerequisites for enjoying the visualization neither for using the code, available in github.
              <br/><br/>
              To be more precise about these insights, in the following paragraphs we will explain what were our data (through data abstraction), why this visualization (through task abstraction) and the reason of how we choice to present the data (idioms : visual encoding and interaction) ; thanks to that, we have been able to answer to the title question : is there the global warming a reality?
              <br/><br/>
              <p style="color:#789410;font-size:110%">What ?</p>
              The dataset type is <b>temporal</b> (initially, we could think that it is a table, but the fact is that almost all the dataset are tables, so we have to search for more precision: in our case,  the dataset is temporal because it provides temperature over time (year by year)). The dataset availability is <b>static</b> because the dataset available on the website is not modified in real-time, so we just download the file from the website and load it on github. Maybe the data can evolve in the original website but here we will use a static data file, the one on github. Then to separate the dataset in smaller ones, and also to get <b>derived data</b> (promedian over 5 years), we process directly this file in the visualization with d3.<br/><br/>

              Before processing the data in d3, the <b>items</b> represent each one a year, which have the same characteristics about temperature change (global change, change in the North, change in the South, change in the Equator, change in the North-Part1, change in the North-Part2, change in the North-Part3, change in the South-Part1, change in the South-Part2, change in the South-Part3). The years and these characteristics are the <b>attributes</b> (named just above).<br/><br/>

              The attribute year is ordered and quantitative and sequential (there is no separation between two groups so no diverging).
              All the other attributes (there are all temperature changes, comparing to the promedian temperature of the years 1950-1980) are ordered and quantitative (because they are numbers) and diverging because there is a separation into two blocks of changes, the positive and the negative ones, which have different meanings each one.<br/><br/>

              After processing the data, we obtain new items : each item is a period of 5 years (quinquennium). The attributes remain quite the same ones : about the year (time period), it becomes a new time period: a quinquennium (a five-year period) with the same characteristics (ordered, quantitative, sequential), and about the different temperature changes it becomes the promedian of temperature change considering the 5 years, remaining with the same characteristics (ordered, quantitative, diverging).<br/><br/>
              <p style="color:#789410;font-size:110%">Why ?</p>
              Before talking about the wanted tasks, we have to mention that we did one derivation task : process the data, transform the items which represented one year into a group of 5 years (and as result, temperature change are now a promedian of the change of the 5 years) so the task, in terms of Tamara was <b>Derive (action) Feature (target)</b>.<br/><br/>

              Which tasks do we want to perform here ? <br/><br/>

              As said in the title, first, the primary task we want to perform here is to show that <b>the global warming is a reality, and in the whole world.</b>
              In terms of Tamara, at a high-level, the action is <b>Present</b> and the target is <b>Trends</b> : we want to show this reality, that in the last decades the temperature on the planet has increased! To be more precise, at a low-level that the action is <b>Identify</b> and the target is <b>Trends</b>. For this behaviour we can use only the dataset <i>Earth zone: Global</i>.
              <br/><br/>
              This is <b>our first insight : the global warming is a reality on the planet.</b>
              <br/><br/>
              To complete this approach, for the primary task, we provided one interaction "Switch dataset" which allow to visualize the data for 3 zones of the planet : North, Equator and South. Thanks to these visualisations, we can show that the global warming is a fact on the whole planet. In terms of Tamara, at a high-level, the action is also <b>Present</b> and the target is <b>Trends</b>, and at a low-level that the action is also <b>Identify</b> and the target is <b>Trends</b>.
              <br/><br/>
              <b>This is our second insight : the global warming is a reality on all the parts of the planet (North, Equator, South).</b>
              <br/><br/>
              One secondary task asked was to show that the global warming is a reality on all continents. Here we would consider that we had a talk with the boss, explaining that with these data, we could not perform this task because there are no data by country o by continent, just with the parallels. No derivations are possible for doing that. That is why we show at least the fact that in each zone (North, South, Equator) the global warming is a reality.
              <br/><br/>

              Another secondary task here, not required/asked here but meaningful, is to know better about the global warming depending on the zones of the world. We want to know where the global warming has been more important, and where not. In terms of Tamara, at a high-level, this task is <b>Discover (action) Features (target)</b> and at a low-level that the action is <b>Compare</b> and the target is <b>Features</b>. We can perform this task by using the interaction "Switch dataset" and then compare on the y axis the highest level of the scale : just by switching, we can observe than in the North the highest level is about 1.2, whereas in the Equator it is about 0.8 and in the South it is about 0.4, so we have been able to compare this feature (the maximum positive temperature change on each zone), knowing already (from task 1) that all the three have a trend of increase in the last decades.
              <br/><br/>
              As a result, <b>our third insight : the global warming, present everywhere on Earth, is even more important in the North of the planet (more than in Equator, where it is more important than in the South).</b>
              <br/><br/>
              And another secondary task here, not required/asked here but meaningful, is to search more precisely for each zone, if there are differences between subzones of this one about the global warming. The aim is to be able to determine if the global warming has been more important in some subzones, or not. In terms of Tamara, at a high-level, this task is <b>Discover (action) Features (target)</b> and at a low-level that the action is <b>Compare</b> and the target is <b>Features</b>. We can perform this task by using the interaction "Show dataset details" (<b>details on demand</b>): by clicking you can observe in the same visualization the temperature changes for 2 or 3 subzones of the current one.
              <br/><br/>
              As a result, <b>our fourth insight : the global warming, present everywhere on Earth, is even more important in the North of the North of the planet : the North Pole. It is a confirmation of something that the media are also telling. But more surprisingly, in the South of the planet, in the South Pole (the South of the South of the planet), the global warming is not more important (it is less important!) than in the northern parts of the South.</b>
              <br/><br/>

              <p style="color:#789410;font-size:110%">How ?</p>

              We choose <b>line charts</b> for this visualization.<br/><br/>
              First, we have to say that for all the datasets, in the x axis, we have the quinquennium attribute which is ordered, quantitative, sequential and in the y axis we have the promedian temperature change attribute (sometimes 2 or 3 times), so ordered, quantitative, diverging.<br/><br/>
              As a result, about the visual encoding, the <b>mark</b> we choose is <b>line</b> which represent the temperature change (comparing the temperature to a promedian from the period 1950-1980) and the <b>channel</b> is <b>vertical position</b> because the attribute temperature change is ordered quantitative; it can be easily explain because this channel is the most <b>effective</b> for the ordered attributes (which should always use magnitude channels, in theory, so from this point of view, we use a good and expressive type).</p>
              Note that we also use, to strengthen the difference between positive and negative values (diverging) of the temperature changes attributes, color hue, for discriminating them better, but with vertical position it was sufficient. And about the view for secondary task where we have multi lines, we use color hue in order to separate each subzone (because at the end, zone is categorical so with color hue we respect the principle of expressiveness and also the one of effectiveness because it is the second "best" channel for categorical attribute).</br>
              As in y axis we have the temperature change which is quantitative ordered, we choose to <b>express</b> the vertical position - it combines well with ordered attributes and with our task (identify trends, identify features, compare features). And as in x axis we have the quinquennium which is quantitative ordered, we choose to <b>express</b> also the position. <br/><br/>
              Then about the interaction, we decide to provide to the user two interactions with two buttons. The first one (switch) is for switching between the dataset, so it’s a <b>Change manipulation</b> : it is usefull for our primary task (show that in the whole world the global warming is a reality) and for a secondary task (compare the global warming between the 3 global zones). The second one (show details) is for showing the detail about temperature changes in 2 or 3 subzones of the current zone of the planet : it is usefull for a secondary task (compare subzones in order to see if the global warming has been more important in some subzones). It’s a <b>Superimpose!</b> And, we provide also a <b>“Select” manipulation</b>, with a mouseover which give more detailed information about the current item or subzone.</p>
              </p>
      </div>

    </div>
    <p style="font-size:90%">The data used come from the nasa open data website - direct link <a href="https://data.giss.nasa.gov/gistemp/tabledata_v3/ZonAnn.Ts+dSST.csv">here</a></p>
    <p style="font-size:90%">This project is under <a href="https://opensource.org/licenses/MIT">MIT license.</a></p>
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>
      // Const margin data for viz
      const width = 900;
      const height = 450;
      const margin = {top: 5, right: 30, bottom: 40, left: 35};
      const iwidth = width - margin.left -margin.right;
      const iheight = height - margin.top - margin.bottom;
      // Const bar chart
      const barwidth = 24;

      // Const range of year grouped by
      const rangeOfYear = 5;

      // SVG and g elements
      var svg = d3.select("#svgcontainer")
          .append("svg")
          .attr("width", iwidth + margin.left + margin.right)
          .attr("height", iheight + margin.top + margin.bottom);
      var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      //Tooltip var
      var tooltip = d3.select("body").append("div").attr("class", "toolTip");

      //Dataset current index
      var dataIndex=1;

      var datasetsTitles = ["Global", "24N-90N","24S-24N","90S-24S"];

      var datasetsNTitles = ["64N-90N ","44N-64N","24N-44N"];
      var datasetsEQTitles = ["EQU-24N ","24S-EQU"];
      var datasetsSTitles = ["44S-24S ","64S-44S ","90S-64S"];

      var maxIndex = datasetsTitles.length;

      // Original data var
      var dataOrigin;

      // Datasets
      var dataYearList1,dataYearList2,dataYearList3,dataYearList4;
      var dataYearListDetailN1,dataYearListDetailN2,dataYearListDetailN3;
      var dataYearListDetailEQ1,dataYearListDetailEQ2;
      var dataYearListDetailS1,dataYearListDetailS2,dataYearListDetailS3;

      //Var for axis x and y
      var xDomain, yDomain, xaxis, yaxis, x, y;

      // Load csv with promise
      d3.csv('https://raw.githubusercontent.com/pierreraimbaud/GlobalWarmingIsReal/master/ZonAnn.Ts%2BdSST.csv').then(function(data) {
          dataOrigin = data;
          //Create bar chart
          createBar();
      });

      //button to swap over datasets
      d3.select("#swButton").on("click",function(){
          updateBar();
      });//end click function

      //button to swap over datasets
      d3.select("#zoomButton").on("click",function(){
          updateBarMulti();
      });//end click function

      //Create bar chart
      function createBar(){
        //Set dataset title
        d3.select("h2").text("Temperature change in °C from 1880 to now - Earth zone: " + datasetsTitles[dataIndex-1]);
        //Set sub title
        d3.select("#subTitleP").text("Promedian temperature change (reference: promedian of the years 1950-1980) for each group of "+ rangeOfYear+" years");
        
        //Data preparation (2 datasets)
        prepareDatasets();        

        //Create Axis
        addAxisForBarChar();

        //Create Bar chart (rect)
        addBarCharRects();
      }

      //Add the axis for bar chart
      function addAxisForBarChar(){

        // X scale definition
        x = d3.scaleBand().rangeRound([0, iwidth])
          .paddingInner(1)
          .paddingOuter(1);

        x.domain((eval("dataYearList"+dataIndex)).map(function(d){
         return d.key*rangeOfYear;}));

        // Y scale definition
        y = d3.scaleLinear().rangeRound([iheight, 0]);
        var min = d3.min(eval("dataYearList"+dataIndex), function(d){
          return +d.value.promedian});
        var max = d3.max(eval("dataYearList"+dataIndex), function(d){
          return +d.value.promedian});
        //We want a symetric domain for positing negative and positive in an easier way
        var dom = Math.max(Math.abs(min),max);
        y.domain([-dom,dom]);

        // Axis x
        xaxis = g.append('g').attr('class', 'xaxis')
            .call(d3.axisBottom(x))
            .attr("transform", `translate(0,${iheight})`)
            .attr("class", "xaxis");

        // Axis y  
        yaxis = g.append('g').attr('class', 'yaxis')
            .call(d3.axisLeft(y));
      }

      //Add the rect (bar chart)
      function addBarCharRects(){
        var dat = eval("dataYearList"+dataIndex);

        // Add the line which join the points
        const line1 = d3.line()
          .x( d=> 0)
          .y( d=> 0);
          
        // Path element
        g.append("path")
          .attr("class", "line1")
          .attr("d", line1(dat))
          .style("stroke", "grey")
          .style("fill", "none");

          // Add the line which join the points
          const line = d3.line()
            .x( d=> x(d.key*rangeOfYear))
            .y( d=> (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2);
          
          // Path element
          g.append("path")
            .attr("class", "line")
            .attr("d", line(dat))
            .style("stroke", "grey")
            .style("fill", "none");

          var circ = svg.selectAll('circle')
            .data(dat)
            .enter()
            .append('circle')
            .attr("class", function(d) { return "circle circle--" + (d.value.promedian > 0.0 ? "positive" : "negative"); })

          var attrX = 
            circ.attr("r", 5)
                .attr("cx", function(d) { return x(d.key*rangeOfYear)+margin.left; })
                .attr("cy", function(d) { return (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2+margin.top; })
            
          //Add rect mouse event
          circ.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html(d.key == (2015/rangeOfYear) ? (d.key*rangeOfYear+"-2017"+": " +(d.value.promedian)+ "°C") : (d.key*rangeOfYear+"-"+(d.key*rangeOfYear+rangeOfYear))+": " +(d.value.promedian)+ "°C");
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});

          const line2 = d3.line()
            .x( d=> 0)
            .y( d=> 0);
          
          // Path element
          g.append("path")
            .attr("class", "line2")
            .attr("d", line2(dat))
            .style("stroke", "grey")
            .style("fill", "none");

          const line3 = d3.line()
            .x( d=> 0)
            .y( d=> 0);
          
          // Path element
          g.append("path")
            .attr("class", "line3")
            .attr("d", line3(dat))
            .style("stroke", "grey")
            .style("fill", "none");
      }

      //Prepare datasets for bar chart
      function prepareDatasets(){

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear1 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["Glob"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearList1 = dataYear1;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear2 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years            
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["24N-90N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearList2 = dataYear2;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear3 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["24S-24N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearList3 = dataYear3;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear4 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["90S-24S"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearList4 = dataYear4;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear5 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["64N-90N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailN1 = dataYear5;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear6 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["44N-64N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailN2 = dataYear6;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear7 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["24N-44N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailN3 = dataYear7;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear8 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["EQU-24N"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailEQ1 = dataYear8;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear9 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["24S-EQU"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailEQ2 = dataYear9;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear10 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["44S-24S"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailS1 = dataYear10;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear11 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["64S-44S"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailS2 = dataYear11;

        //Nest data for getting it as (key=year range, value.promedian=promedian temperature change of the X years)
        var dataYear12 = d3.nest()
          .key(function(d){
            // The keys are the year divided by the range of year, in order to group by X years
            return Math.trunc(+(d.Year)/rangeOfYear);
          })
          .rollup(function(d){
            return {
              promedian : d3.sum(d, function(g){
                return (+g["90S-64S"])/d.length;
              }).toFixed(3)
            }
          })
          .entries(dataOrigin);
          dataYearListDetailS3 = dataYear12;
      }

      //Update the bars based on the dataset change (switch)
      function updateBar(){

        //select new data
        if (dataIndex==maxIndex){
          d3.select("#zoomButton").attr("disabled", true)
          dataIndex=1;
          
        }
        else{
          d3.select("#zoomButton").attr("disabled", null)
          dataIndex++;
        }

        //Update x and y axis

        //1 - rejoin data
        xaxis = g.selectAll(".xaxis");
        
        //2 - Remove axis
        xaxis.exit().remove();//remove unneeded axis

        var yaxis = g.selectAll(".yaxis");
          
        xaxis.exit().remove();//remove unneeded axis

        //3 - Update axis
        xaxis.enter().append("xaxis")
          .attr("class", "xaxis");

        yaxis.enter().append("yaxis")
          .attr("class", "yaxis");

        // X scale
        x = d3.scaleBand().rangeRound([0, iwidth])
         .paddingInner(1)
         .paddingOuter(1);
        xDomain = (eval("dataYearList"+dataIndex)).map(function(d){return d.key*rangeOfYear; });
        x.domain(xDomain);

        // Y scale
        y = d3.scaleLinear().rangeRound([iheight, 0]);
        var min = d3.min(eval("dataYearList"+dataIndex), function(d){
          return +d.value.promedian});
        var max = d3.max(eval("dataYearList"+dataIndex), function(d){
          return +d.value.promedian});
        var dom = Math.max(Math.abs(min),max);
        yDomain = [-dom,dom]
        y.domain(yDomain);

        // Axis x
        xaxis =g.selectAll(".xaxis").data(xDomain);
        xaxis.exit().remove();//remove unneeded axis
        xaxis.enter().append("g");

        xaxis.attr('class', 'xaxis').call(d3.axisBottom(x));
        xaxis.attr("transform", `translate(0,${iheight})`)

        // Axis y  
        yaxis =g.selectAll(".yaxis").data(yDomain);
        yaxis.exit().remove();//remove unneeded axis
        yaxis.enter().append("g");

        yaxis.attr('class', 'yaxis').call(d3.axisLeft(y));

        //Update line
        //1 - rejoin data
        var line = g.selectAll(".line");        
        //2 - Remove line
        line.exit().remove();//remove unneeded lines
        //3 - Update line
        line.enter().append("path")
          .attr("class", "line");

        // Add the line which join the points
        const linef = d3.line()
          .x( d=> x(d.key*rangeOfYear))
          .y( d=> (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2);
          
        // Path element
        line.attr("d", linef(eval("dataYearList"+dataIndex)));
        line.style("stroke", "grey");
        line.style("fill", "none");

        //Update points
        //1 - rejoin data
        var dots = svg.selectAll('circle').data(eval("dataYearList"+dataIndex));
        //2 - Remove points
        dots.exit().remove();//remove unneeded points
        //3 - Update points
        dots.enter().append("circle");

        dots.attr("r", 5);

        dots.attr("cx", function(d) { return x(d.key*rangeOfYear)+margin.left; });
        dots.attr("cy", function(d) { return (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2+margin.top; });
        //Add rect mouse event
        dots.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html(d.key == (2015/rangeOfYear) ? (d.key*rangeOfYear+"-2017"+": " +(d.value.promedian)+ "°C") : (d.key*rangeOfYear+"-"+(d.key*rangeOfYear+rangeOfYear))+": " +(d.value.promedian)+ "°C");
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");})
            .attr("class", function(d) { return "circle circle--" + (d.value.promedian > 0.0 ? "positive" : "negative"); });

        //Update multi lines part (for preparation or for quitting them)
        //1 - rejoin data
        var line1 = g.selectAll(".line1");        
        //2 - Remove lines
        line1.exit().remove();//remove unneeded lines
        //3 - Update lines
        line1.enter().append("path")
          .attr("class", "line1");
        // Add the line which join the points
        const linef1 = d3.line()
          .x( d=> 0)
          .y( d=> 0);
          
        // Path element
        line1.attr("d", linef1(eval("dataYearList"+dataIndex)));
        line1.style("stroke", "grey");
        line1.style("fill", "none");

        //1 - rejoin data
        var line2 = g.selectAll(".line2");        
        //2 - Remove lines
        line2.exit().remove();//remove unneeded lines
        //3 - Update lines
        line2.enter().append("path").attr("class", "line2");

        // Add the line which join the points
        const linef2 = d3.line()
          .x( d=> 0)
          .y( d=> 0);
        
        // Path element
        line2.attr("d", linef2(eval("dataYearList"+dataIndex)));
        line2.style("stroke", "grey");
        line2.style("fill", "none");

        //1 - rejoin data
        var line3 = g.selectAll(".line3");        
        //2 - Remove lines
        line3.exit().remove();//remove unneeded lines
        //3 - Update lines
        line3.enter().append("path").attr("class", "line3");

        // Add the line which join the points
        const linef3 = d3.line()
          .x( d=> 0)
          .y( d=> 0);
          
        // Path element
        line3.attr("d", linef3(eval("dataYearList"+dataIndex)));
        line3.style("stroke", "grey");
        line3.style("fill", "none");

        //Change text  
        d3.select("h2").text("Temperature change in °C from 1880 to now - Earth zone: " + datasetsTitles[dataIndex-1]);
      }

      //Update the bar chart in multi bar chart based on the dataset change (zoom)
      function updateBarMulti(){

        //Get the correct title of the dataset depend on the current dataset and the current index (for tooltip)
        function getDTitle(txt, index) {
          if (txt=="N") {
            return datasetsNTitles[index];
          }
          if (txt=="EQ") {
            return datasetsEQTitles[index];
          }
          if (txt=="S") {
            return datasetsSTitles[index];
          }
        }
        
        //Update bar part(rect)
        if (dataIndex!=1){
          d3.select("#zoomButton").attr("disabled", true)
          var worldBand;
          if (dataIndex==2){
            worldBand = "N";
          }
          if (dataIndex==3){
            worldBand = "EQ";
          }
          if (dataIndex==4){
            worldBand = "S";
          }

          //Update y axis (not X because common to all the "detailed" datasets)
          var yaxis = g.selectAll(".yaxis");
          yaxis.enter().append("yaxis")
            .attr("class", "yaxis");

          // Y scale
          y = d3.scaleLinear().rangeRound([iheight, 0]);
          //Find the min and max of the 2 or 3 detailed datasets
          var min = d3.min(eval("dataYearListDetail"+worldBand+"1"), function(d){
            return +d.value.promedian});
          var max = d3.max(eval("dataYearListDetail"+worldBand+"1"), function(d){
            return +d.value.promedian});
          var m2 =d3.min(eval("dataYearListDetail"+worldBand+"2"), function(d){
            return +d.value.promedian});
          if (min>m2){
            min=m2;
          }
          var mn2 =d3.max(eval("dataYearListDetail"+worldBand+"2"), function(d){
            return +d.value.promedian});
          if (max<mn2){
            max=mn2;
          }
          if (worldBand !="EQ"){
            var m3 = d3.min(eval("dataYearListDetail"+worldBand+"3"), function(d){
              return +d.value.promedian});
            
            if (min>m3){
              min=m3;
            }
            var mn3 =d3.max(eval("dataYearListDetail"+worldBand+"3"), function(d){
              return +d.value.promedian});
            if (max<mn3){
              max=mn3;
            }
          }
          var dom = Math.max(Math.abs(min),max);
          yDomain = [-dom,dom]
          y.domain(yDomain);

          // Axis y  
          yaxis =g.selectAll(".yaxis").data(yDomain);
          yaxis.exit().remove();//remove unneeded rects
          yaxis.enter().append("g");

          yaxis.attr('class', 'yaxis').call(d3.axisLeft(y));

          //Update lines- to remove them
          //1 - rejoin data
          var line = g.selectAll(".line");          
          //2 - Remove lines
          line.exit().remove();//remove unneeded lines
          //3 - Update lines
          line.enter().append("path")
            .attr("class", "line");

          // Add the line which join the points
          const linef = d3.line()
            .x( d=> 0)
            .y( d=> 0);
          
          // Path element
          line.attr("d", linef(eval("dataYearList"+dataIndex)));
          line.style("stroke", "grey");
          line.style("fill", "none");

          //1 - rejoin data
          var dots = svg.selectAll('circle').data(eval("dataYearList"+dataIndex));
          //2 - Remove points
          dots.exit().remove();//remove unneeded points
          //3 - Update points
          dots.enter().append("circle");
          dots.attr("r", 0);
          dots.attr("cx",0);
          dots.attr("cy", 0);//create any new rects points

          //Update multi lines part - (first line)

          //1 - rejoin data
          var line1 = g.selectAll(".line1");
        
          //2 - Remove bar (rect)
          line1.exit().remove();//remove unneeded rects
       
          //3 - Update bar (rect)
          line1.data(eval("dataYearListDetail"+worldBand+"1")).append("path").attr("class", "line1");

          // Add the line which join the points
          const linef1 = d3.line()
            .x( d=> x(d.key*rangeOfYear))
            .y( d=> (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2);
          
          // Path element
          line1.attr("d", linef1(eval("dataYearListDetail"+worldBand+"1")));
          line1.style("stroke", "800080");
          line1.style("fill", "none");
          line1.attr("stroke-width", 2.5);
          line1.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html("Zone: " +getDTitle(worldBand, 0));
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");})
          
          //Update multi lines part - (second line)

          //1 - rejoin data
          var line2 = g.selectAll(".line2");        
          //2 - Remove line
          line2.exit().remove();//remove unneeded line
       
          //3 - Update line
          line2.data(eval("dataYearListDetail"+worldBand+"2")).append("path").attr("class", "line2");

          // Add the line which join the points
          const linef2 = d3.line()
            .x( d=> x(d.key*rangeOfYear))
            .y( d=> (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2);
          
          // Path element
          line2.attr("d", linef2(eval("dataYearListDetail"+worldBand+"2")));
          line2.style("stroke", "ff6600");
          line2.style("fill", "none");
          line2.attr("stroke-width", 2.5);
          line2.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html("Zone: " +getDTitle(worldBand, 1));
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});

          //Update multi lines part - (third line)
          if (worldBand !="EQ"){
            //1 - rejoin data
            var line3 = g.selectAll(".line3");        
            //2 - Remove bar (rect)
            line3.exit().remove();//remove unneeded rects
           
            //3 - Update bar (rect)
            line3.data(eval("dataYearListDetail"+worldBand+"3")).append("path").attr("class", "line3");

            // Add the line which join the points
            const linef3 = d3.line()
              .x( d=> x(d.key*rangeOfYear))
              .y( d=> (height -(margin.top+margin.bottom))/2 - ((height -(margin.top+margin.bottom)) - y(+d.value.promedian)*2)/2);
            
            // Path element
            line3.attr("d", linef3(eval("dataYearListDetail"+worldBand+"3")));
            line3.style("stroke", "408000");
            line3.style("fill", "none");
            line3.attr("stroke-width", 2.5);
            line3.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html("Zone: " +getDTitle(worldBand, 2));
              })
              .on("mouseout", function(d){ tooltip.style("display", "none");});
         }
        }
      }
    </script>

    <div class="wrapper">
      <header>
        <p><a href="">Link of this page - for sharing for example</a></p>
      </header>
      <section>
        <p class="view"><a href="https://github.com/pierreraimbaud/GlobalWarmingIsReal">Project URL on GitHub <small>pierreraimbaud/GlobalWarmingIsReal</small></a>   -   <a style="font-size:90%" href="https://github.com/pierreraimbaud/GlobalWarmingIsReal#markdown">Markdown link</a></p>        
      </section>
      <footer>
        <p>Author and link : this project is maintained by <a href="https://github.com/pierreraimbaud">pierreraimbaud</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src=""></script>
    
  </body>
</html>